---
import { Image } from "astro:assets";
import ThemeToggle from "../components/ThemeToggle.astro";

import meImage from "@images/me@2x.png";

const navLinks = [
  {
    label: "Work",
    href: "/",
  },
  {
    label: "Resume",
    href: "/resume",
  },
  {
    label: "Contact",
    href: "mailto:kachun@kachunchau.com",
  },
];
---

<header
  class="mx-auto flex max-w-6xl items-center gap-4 px-10 py-5 md:px-20 md:py-10 xl:mx-auto xl:px-0"
  transition:persist
>
  <nav class="flex flex-1 items-center gap-3 md:gap-6">
    <Image
      class="size-9 rounded-full md:size-10"
      src={meImage}
      alt="Me"
      densities={[1, 2]}
      width={40}
      height={40}
    />

    <ul class="flex">
      {
        navLinks.map((item) => (
          <li>
            <a
              class="inline-block rounded-full px-3 py-1.5 text-base font-medium whitespace-nowrap backdrop-blur-md hover:text-teal-400 md:px-4 md:text-xl"
              href={item.href}
            >
              {item.label}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>

  <ThemeToggle />
</header>

<script>
  const updateActiveState = () => {
    const currentPath = window.location.pathname;

    // Log all links found
    const allLinks = document.querySelectorAll("header a[href]");

    allLinks.forEach((link) => {
      const href = link.getAttribute("href");
      if (!href || href.startsWith("mailto:")) return;

      // Special handling for work pages
      const isActive =
        href === "/"
          ? currentPath === "/" || currentPath.startsWith("/work")
          : currentPath.startsWith(href);

      if (isActive) {
        link.setAttribute("aria-current", "page");
        link.classList.add("bg-teal-400/10", "text-teal-400");
      } else {
        link.removeAttribute("aria-current");
        link.classList.remove("bg-teal-400/10", "text-teal-400");
      }
    });
  };

  // Initialize on page load
  document.addEventListener("DOMContentLoaded", updateActiveState);

  // Handle navigation
  document.addEventListener("astro:page-load", updateActiveState);
</script>
